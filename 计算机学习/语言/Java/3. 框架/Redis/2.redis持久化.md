# redis持久化
#数据存储 
数据存储/备份两种方式：快照，日志

redis数据存储的两种方式：
- RDB ->快照式 具有时点性(取创建快照前的版本,实现见下) 恢复快，缺失多
 > 时点性的实现： 使用操作系统特性 子进程 设置 COPY ON WRITE
- AOF ->日志式 数据完整，恢复慢(日志是String 读取还原慢)
- 混合使用 (4.x之后)

## RDB

## AOF
AOF日志刷写频率：
1. 每操作
    会调用操作系统指令 fsync,触发落盘。完整性最好，但导致一致性下降
2. 每秒钟
    操作系统(OS)缓冲刷写，但每秒强制落一次盘。 **默认** 要丢失丢失量小于一个 buffer
3. 操作系统(OS)缓冲刷写
    操作系统控制 往往丢失一个buffer.

缺陷：
1. 冗余量大 日志文件越来越大，有很多无效操作 
   -> 日志压缩/重写(指令抵消) 其实将内存数据重新生成指令写入日志？
2. 慢 因为要重做命令，计算量大

## 混合使用
在**AOF模式**下，AOF 日志重写时 文件头上线使用RDB生成一个快照代替指令抵消，后续的日志记录往后追加。
->